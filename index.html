<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HavenSpace | Private Wishlist</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f8fafc; }
    .glass-card { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.5); }
    .gradient-text { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    #appContent { display: none; } 
  </style>
</head>
<body class="text-slate-800">

  <div id="loginPage" class="fixed inset-0 z-[100] bg-white flex flex-col items-center justify-center p-6 text-center">
    <div class="bg-indigo-600 p-4 rounded-3xl mb-6 shadow-xl shadow-indigo-100">
      <i data-lucide="home" class="text-white w-12 h-12"></i>
    </div>
    <h1 class="text-3xl font-bold text-slate-900 mb-2">Selamat Datang di HavenSpace</h1>
    <p class="text-slate-500 mb-8 max-w-sm">Masuk dengan akun Google untuk sinkronisasi wishlist pribadi kamu di semua perangkat.</p>
    <button onclick="login()" class="flex items-center gap-3 bg-white border border-slate-200 px-8 py-4 rounded-2xl font-bold shadow-sm hover:shadow-md transition-all active:scale-95 text-slate-700">
      <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/pjax/google.svg" width="20">
      Masuk dengan Google
    </button>
  </div>

  <div id="appContent">
    <nav class="sticky top-0 z-50 bg-white/70 backdrop-blur-md border-b border-slate-100">
      <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
        <div class="flex items-center gap-2">
          <span class="text-xl font-bold tracking-tight text-slate-900">Haven<span class="text-indigo-600">Space.</span></span>
        </div>
        <div class="flex items-center gap-4">
          <img id="userPhoto" class="w-8 h-8 rounded-full border border-slate-200">
          <button onclick="logout()" class="text-slate-400 hover:text-red-500"><i data-lucide="log-out" class="w-5 h-5"></i></button>
        </div>
      </div>
    </nav>

    <header class="max-w-6xl mx-auto px-6 pt-12 pb-8">
      <h1 class="text-4xl font-extrabold text-slate-900">Bangun Kamar <span class="gradient-text">Impianmu.</span></h1>
    </header>

    <section class="max-w-6xl mx-auto px-6 mb-10">
      <div class="glass-card rounded-3xl shadow-xl p-8 grid md:grid-cols-4 gap-6">
        <input id="name" type="text" placeholder="Nama Barang" class="bg-slate-100 rounded-2xl px-5 py-3.5 outline-none focus:ring-2 focus:ring-indigo-400" />
        <input id="price" type="number" placeholder="Harga (Rp)" class="bg-slate-100 rounded-2xl px-5 py-3.5 outline-none focus:ring-2 focus:ring-indigo-400" />
        <input id="link" type="url" placeholder="Link Shopee/Toko" class="bg-slate-100 rounded-2xl px-5 py-3.5 outline-none focus:ring-2 focus:ring-indigo-400" />
        <button onclick="addItem()" class="bg-indigo-600 text-white rounded-2xl py-3.5 font-bold hover:bg-indigo-700 transition">Tambah Item</button>
      </div>
    </section>

    <section class="max-w-6xl mx-auto px-6 mb-12 grid grid-cols-2 md:grid-cols-3 gap-6">
      <div class="bg-white rounded-3xl p-6 shadow-sm border border-slate-100">
        <p class="text-sm font-medium text-slate-500">Total Item</p>
        <h2 id="totalItems" class="text-2xl font-bold">0</h2>
      </div>
      <div class="bg-white rounded-3xl p-6 shadow-sm border border-slate-100">
        <p class="text-sm font-medium text-slate-500">Estimasi Budget</p>
        <h2 id="totalPrice" class="text-2xl font-bold text-emerald-600">Rp 0</h2>
      </div>
    </section>

    <section class="max-w-6xl mx-auto px-6 pb-20">
      <div id="list" class="grid md:grid-cols-3 gap-8"></div>
    </section>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, where, onSnapshot, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    
    const firebaseConfig = {
  apiKey: "AIzaSyCyEEBA8gvEX3EcnN8obNe9krGa80ETHFM",
  authDomain: "havenspace-ac22a.firebaseapp.com",
  projectId: "havenspace-ac22a",
  storageBucket: "havenspace-ac22a.firebasestorage.app",
  messagingSenderId: "316479777786",
  appId: "1:316479777786:web:4e7450bb9df120259e1243"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    let currentUser = null;

    // Login Function
    window.login = () => signInWithPopup(auth, provider);
    window.logout = () => signOut(auth);

    // Auth Listener
    onAuthStateChanged(auth, (user) => {
      if (user) {
        currentUser = user;
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('appContent').style.display = 'block';
        document.getElementById('userPhoto').src = user.photoURL;
        loadData();
      } else {
        document.getElementById('loginPage').style.display = 'flex';
        document.getElementById('appContent').style.display = 'none';
      }
      lucide.createIcons();
    });

    // Load Data from Firestore
    function loadData() {
      const q = query(collection(db, "wishlist"), where("userId", "==", currentUser.uid));
      onSnapshot(q, (snapshot) => {
        const list = document.getElementById('list');
        list.innerHTML = '';
        let total = 0;
        let count = 0;

        snapshot.forEach((doc) => {
          const item = doc.data();
          total += item.price;
          count++;
          list.innerHTML += `
            <div class="bg-white rounded-[2rem] p-6 shadow-sm border border-slate-50 hover:shadow-xl transition-all">
              <div class="flex justify-between mb-4">
                <div class="bg-indigo-50 text-indigo-600 p-2 rounded-xl"><i data-lucide="box" class="w-5 h-5"></i></div>
                <button onclick="removeItem('${doc.id}')" class="text-slate-300 hover:text-red-500"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
              </div>
              <h3 class="font-bold text-xl mb-1">${item.name}</h3>
              <p class="text-indigo-600 font-extrabold text-lg mb-6">Rp ${item.price.toLocaleString('id-ID')}</p>
              <a href="${item.link}" target="_blank" class="w-full inline-flex items-center justify-center gap-2 bg-slate-900 text-white font-semibold py-3 rounded-2xl hover:bg-slate-800 transition">Cek Toko <i data-lucide="external-link" class="w-4 h-4"></i></a>
            </div>
          `;
        });
        document.getElementById('totalItems').innerText = count;
        document.getElementById('totalPrice').innerText = 'Rp ' + total.toLocaleString('id-ID');
        lucide.createIcons();
      });
    }

    // Add Data to Firestore
    window.addItem = async () => {
      const name = document.getElementById('name').value;
      const price = Number(document.getElementById('price').value);
      const link = document.getElementById('link').value;

      if (!name || !price || !link) return alert('Lengkapi data!');

      await addDoc(collection(db, "wishlist"), {
        name, price, link, userId: currentUser.uid, createdAt: new Date()
      });

      document.getElementById('name').value = '';
      document.getElementById('price').value = '';
      document.getElementById('link').value = '';
    };

    // Remove Data
    window.removeItem = async (id) => {
      if(confirm('Hapus item?')) await deleteDoc(doc(db, "wishlist", id));
    };

  </script>
</body>
</html>